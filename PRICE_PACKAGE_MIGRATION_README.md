# Migrasi Komponen ProductAndServices ke Skema Tabel Baru

## Overview
Komponen `ProductAndServices.svelte` telah disesuaikan dengan skema tabel `price_package` yang baru di Supabase.

## Perubahan Skema Tabel

### Tabel Lama (jika ada)
- Menggunakan struktur yang berbeda dengan field seperti `description`, `category`, `duration`, `is_active`, `custom_fields`, `image_url`

### Tabel Baru: `price_package`
```sql
CREATE TABLE public.price_package (
  id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  pakej text NULL,                    -- Nama paket/layanan
  harga double precision NULL,        -- Harga paket/layanan
  url text NULL,                      -- URL eksternal
  services jsonb NULL,                -- Data tambahan dalam format JSON
  CONSTRAINT price_package_pkey PRIMARY KEY (id)
);
```

## Perubahan pada Komponen

### 1. Struktur Data
- **Field `pakej`**: Nama produk/layanan (text)
- **Field `harga`**: Harga (double precision)
- **Field `url`**: URL eksternal (text)
- **Field `services`**: Object JSON yang berisi:
  - `category`: Kategori layanan
  - `description`: Deskripsi
  - `duration`: Durasi layanan
  - `is_active`: Status aktif/nonaktif
  - Field custom lainnya

### 2. Form Input
- Form input untuk `pakej`, `harga`, dan `url`
- Field kategori, deskripsi, durasi, dan status aktif dipindah ke dalam object `services`
- Custom fields ditangani melalui object `services`

### 3. Fungsi yang Diperbarui
- `loadPackages()`: Menyesuaikan dengan struktur data baru
- `savePackage()`: Menyimpan data sesuai skema baru
- `filterAndSortPackages()`: Filter berdasarkan data dari `services`
- `getUniqueCategories()`: Mengambil kategori dari `services`

### 4. UI yang Diperbarui
- Menghapus fitur upload gambar (tidak ada di skema baru)
- Menambahkan field URL dengan icon link
- Menampilkan URL sebagai link yang bisa diklik
- Services ditampilkan sebagai custom fields yang bisa dikelola

## Cara Implementasi

### 1. Buat Tabel di Supabase
Jalankan SQL dari file `create_price_package_table.sql` di Supabase Dashboard > SQL Editor

### 2. Update Komponen
Komponen `ProductAndServices.svelte` sudah diupdate dan siap digunakan

### 3. Test CRUD Operations
- **Create**: Tambah produk/layanan baru
- **Read**: Lihat daftar produk/layanan
- **Update**: Edit produk/layanan yang ada
- **Delete**: Hapus produk/layanan

## Fitur yang Tersedia

### ✅ Fitur yang Dipertahankan
- CRUD operations lengkap
- Search dan filter berdasarkan nama dan services
- Sorting berdasarkan nama, harga, kategori, tanggal
- Grid dan list view
- Custom fields (services) yang fleksibel
- Validasi input

### ❌ Fitur yang Dihapus
- Upload dan manajemen gambar
- Field `image_url`

### 🆕 Fitur Baru
- Field URL eksternal
- Link ke detail produk/layanan
- Struktur data yang lebih fleksibel dengan JSON

## Contoh Data

### Input Form
```javascript
{
  pakej: "Facial Treatment Premium",
  harga: 250000,
  url: "https://example.com/facial-premium",
  services: {
    category: "Facial",
    description: "Treatment facial premium dengan bahan berkualitas tinggi",
    duration: "90 menit",
    is_active: true,
    bahan: "Natural ingredients",
    manfaat: "Anti-aging, brightening"
  }
}
```

### Output Database
```json
{
  "id": 1,
  "created_at": "2024-01-15T10:30:00Z",
  "pakej": "Facial Treatment Premium",
  "harga": 250000,
  "url": "https://example.com/facial-premium",
  "services": {
    "category": "Facial",
    "description": "Treatment facial premium dengan bahan berkualitas tinggi",
    "duration": "90 menit",
    "is_active": true,
    "bahan": "Natural ingredients",
    "manfaat": "Anti-aging, brightening"
  }
}
```

## Troubleshooting

### Error yang Mungkin Muncul
1. **Table not found**: Pastikan tabel `price_package` sudah dibuat
2. **Column not found**: Pastikan struktur tabel sesuai dengan skema
3. **JSON parsing error**: Pastikan data `services` valid JSON

### Solusi
1. Jalankan SQL migration dengan benar
2. Restart aplikasi setelah perubahan
3. Periksa console browser untuk error detail

## Catatan Penting
- Komponen ini sekarang menggunakan field `services` sebagai JSON untuk menyimpan data tambahan
- Semua operasi CRUD sudah disesuaikan dengan skema baru
- Fitur search dan filter bekerja berdasarkan data dari object `services`
- URL eksternal ditampilkan sebagai link yang bisa diklik

